<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>prief | about share and go on</title>

  
  <meta name="author" content="prief">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="prief">

  
  <meta property="og:image" content="/favicon.ico">
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="prief" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">prief</a>
    </h1>
    <p class="site-description">about share and go on</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2019/08/11/my-tools/"><span>my tools</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/08/11/my-tools/" rel="bookmark">
        <time class="entry-date published" datetime="2019-08-11T03:13:12.000Z">
          2019-08-11
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="os"><a href="#os" class="headerlink" title="os"></a>os</h1><ul>
<li>git</li>
<li>node</li>
<li>iterm</li>
<li>wireshark</li>
</ul>
<h1 id="fe"><a href="#fe" class="headerlink" title="fe"></a>fe</h1><ul>
<li>chrome</li>
<li>vscode<ul>
<li>vscode-icons</li>
<li>markdown TOC</li>
</ul>
</li>
</ul>
<h1 id="android"><a href="#android" class="headerlink" title="android"></a>android</h1><ul>
<li>as</li>
</ul>
<h1 id="ios"><a href="#ios" class="headerlink" title="ios"></a>ios</h1><ul>
<li>homebrew</li>
<li>xcode</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/tools/">tools</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/08/11/net-protocol-capature-packets/"><span>net protocol &amp; capature packets</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/08/11/net-protocol-capature-packets/" rel="bookmark">
        <time class="entry-date published" datetime="2019-08-10T23:30:55.000Z">
          2019-08-11
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="协议栈"><a href="#协议栈" class="headerlink" title="协议栈"></a>协议栈</h2><ul>
<li>应用层<ul>
<li>http/1.1</li>
<li>websocket</li>
<li>http/2.0</li>
</ul>
</li>
<li>表示层<ul>
<li>tls/ssl</li>
</ul>
</li>
<li>传输层<ul>
<li>tcp</li>
</ul>
</li>
<li>网络层<ul>
<li>ip</li>
</ul>
</li>
<li>链路层<ul>
<li>以太网</li>
</ul>
</li>
</ul>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><ul>
<li>chrome</li>
<li>wireshark</li>
<li>dig</li>
<li>tcpdump</li>
</ul>
<h1 id="http-1-1"><a href="#http-1-1" class="headerlink" title="http/1.1"></a>http/1.1</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><ul>
<li>RFC: request for comments</li>
<li>http/1.1<ul>
<li>无状态</li>
<li>请求/响应模式</li>
<li>可扩展的语义</li>
<li>自描述的消息格式</li>
</ul>
</li>
<li>ABNF: 扩充巴科斯-瑙尔范式<ul>
<li>空白字符SP来分割各个元素</li>
<li>/表示可供选择的规则</li>
<li>%x##-##表示值的范围</li>
<li>()组合，视为一个元素</li>
<li>m*n表示重复m-n次</li>
<li>[]表示可选序列</li>
<li>DIGIT表示数字</li>
<li>HEXDIG表示十六进制数字</li>
<li>SP表示空格</li>
<li>CRLF表示兼容的回车换行</li>
</ul>
</li>
<li>OSI: open system interconnection reference model概念模型<ul>
<li>应用层（http/email/dns/smtp/ftp/telnet）</li>
<li>表示层（ssl）</li>
<li>会话层（session）</li>
<li>传输层（tcp/udp）</li>
<li>网络层（ip，广域网路由器）</li>
<li>数据链路层（mac，局域网交换机）</li>
<li>物理层</li>
</ul>
</li>
<li>TCP/IP 事实实现方案<ul>
<li>应用层（http/email/dns/smtp/ftp/telnet）</li>
<li>传输层（tcp/udp）</li>
<li>网络层（ip/icmp/arp）</li>
<li>物理层（ethernet）</li>
</ul>
</li>
<li>评估web架构的关键属性<ul>
<li>性能performance<ul>
<li>网络性能 throughput吞吐量&lt;=bandwidth</li>
<li>用户感知性能</li>
<li>网络效率 缓存/cdn/减少交互次数</li>
</ul>
</li>
<li>可伸缩性scalability</li>
<li>简单性simplicity</li>
<li>可见性visiable</li>
<li>可移植性portablity</li>
<li>可靠性reliability</li>
<li>可修改性modifiability<ul>
<li>可进化</li>
<li>可定制</li>
<li>可扩展</li>
<li>可配置</li>
<li>可重用</li>
</ul>
</li>
</ul>
</li>
<li>URI<ul>
<li>URI是URL+URN的超集，统一掉概念</li>
<li>schema://user:pass@hostname:port/path?query#fragment</li>
</ul>
</li>
<li>method<ul>
<li>GET</li>
<li>HEAD</li>
<li>POST</li>
<li>PUT</li>
<li>DELETE</li>
<li>CONNECT</li>
<li>OPTIONS</li>
<li>TRACE</li>
</ul>
</li>
<li>status<ul>
<li>1xx 请求服务器已经收到，需要进一步处理<ul>
<li>100 Continue常用上传大文件前</li>
<li>101 Switch Protocols升级协议ws/h2</li>
<li>102 Processing webdav协议</li>
</ul>
</li>
<li>2xx 成功处理了请求，当接收到不认识的2xx时默认用200<ul>
<li>200 OK</li>
<li>201 Created成功创建</li>
<li>202 Accepted</li>
<li>206 Partial Content 使用range协议返回部分内容</li>
</ul>
</li>
<li>3xx 重定向<ul>
<li>301 Moved Permanently 永久重定向，可被缓存</li>
<li>302 Found 临时重定向，不能被缓存</li>
<li>304 Not Modified 可复用缓存</li>
</ul>
</li>
<li>4xx 客户端错误<ul>
<li>400 Bad Request</li>
<li>401 Unauthorized未认证</li>
<li>403 Forbidden</li>
<li>404 Not Found</li>
</ul>
</li>
<li>5xx 服务端错误<ul>
<li>500 Internel Server Error 内部服务器错误，当接收到不认识的5xx时默认用500</li>
<li>501 Not Implemented</li>
<li>502 Bad Gateway</li>
<li>503 Service Unavailable</li>
<li>504 Gateway Timeout</li>
</ul>
</li>
</ul>
</li>
<li>长短连接 <ul>
<li>Connection: Keep-Alive | Close</li>
<li>http/1.1默认支持长连接</li>
<li>如果Connection后面跟header字段则表示对代理服务器要求不做此header转发</li>
<li>Connection只表示tcp连接的两端，不能表示跨中间的服务器</li>
</ul>
</li>
<li>header<ul>
<li>X-Forwarded-For 用于传递ip，每走一层都会append一个ip</li>
<li>X-Real-IP 只记录用户外网ip</li>
<li>Referer 来源，通常做防盗链</li>
<li>User-Agent</li>
<li>From 通常是爬虫添加的后面跟邮件地址告诉server可通过邮件联系</li>
<li>Allow server支持的method</li>
<li>Accept* 协商资源表现形式<ul>
<li>Accept: MIME q=0.8;</li>
<li>Accept-Language: zh-CN,zh q=0.8</li>
<li>Accept-Encoding: gzip | br | deflate</li>
<li>Accept-Range: bytes | none 是否支持range请求</li>
</ul>
</li>
<li>Transer-Encoding: chunked | gzip 不定长包体传输格式</li>
<li>Content-Disposition: inline | attachment[; filename=xx.xx]</li>
</ul>
</li>
<li>MIME<ul>
<li>Multipurpose Internet Mail Extensions</li>
<li>格式：type/subType(;params)</li>
<li>type<ul>
<li>text</li>
<li>image</li>
<li>audio</li>
<li>video</li>
<li>application</li>
</ul>
</li>
<li>params<ul>
<li>attribute=value</li>
</ul>
</li>
</ul>
</li>
<li>Form关键属性<ul>
<li>action表示uri</li>
<li>method表示方法<ul>
<li>GET</li>
<li>POST</li>
</ul>
</li>
<li>enctype<ul>
<li>application/x-www-form-urlencoded 默认编码方式 k=v&amp;k=v 需要encode</li>
<li>multipart/form-data 有boundary做分割，一般用于文件传输</li>
</ul>
</li>
</ul>
</li>
<li>Range请求<ul>
<li>做多线程下载/断点续传/点播视频等</li>
<li>请求头部标明<ul>
<li>Range: bytes=0-499[,500-1000[,1001-]]</li>
<li>Range: bytes=-4 最后3个字节</li>
<li>If-Range: Etag | httpDate 验证已经下载的部分是否有变动</li>
</ul>
</li>
<li>响应头部标明<ul>
<li>Content-Range: bytes 0-100/2000 表示共2000长度，返回了前101字节</li>
<li>Content-Range: bytes 0-100/* 表示不知道总长度但返回了前101字节  </li>
<li>Content-Range: multipart/byterages; boundary=…</li>
</ul>
</li>
</ul>
</li>
<li>cookie<ul>
<li>Set-Cookie<ul>
<li>每一个Set-Cookie只能设置一个name=value，如需多个需要多个Set-Cookie</li>
<li>name=value; expires= httpDate; max-age=X; domain=X; path=/; secure; httpOnly;</li>
</ul>
</li>
<li>Cookie<ul>
<li>可以把多个Set-Cookie返回的name组合成一个进行请求</li>
<li>name=value;[ name=value;]</li>
</ul>
</li>
</ul>
</li>
<li>同源三要素<ul>
<li>schema</li>
<li>hostname</li>
<li>port</li>
</ul>
</li>
<li>跨域<ul>
<li>可跨域的组件（满足可扩展可用性）<ul>
<li>script</li>
<li>link</li>
<li>img</li>
<li>iframe</li>
<li>video</li>
<li>audio</li>
</ul>
</li>
<li>攻击与防护<ul>
<li>csrf <ul>
<li>cross-site request forgery</li>
<li>通过referer可做一层防护</li>
<li>通过csrfToken即服务器响应表单时添加隐藏的token信息已备后续验证也可做防护</li>
</ul>
</li>
<li>xss cross-site scripting</li>
</ul>
</li>
<li>cors<ul>
<li>cross origin resource sharing</li>
<li>简单请求三要素<ul>
<li>GET/HEAD/POST之一</li>
<li>Accepte/Accept-Language/Content-Type安全header之一</li>
<li>Content-Type是text/plain|application/x-www-form-urlencoded|multipart/form-data之一</li>
</ul>
</li>
<li>复杂请求<ul>
<li>简单请求之外的都是复杂请求</li>
<li>复杂请求必须先走一个OPTIONS请求</li>
</ul>
</li>
<li>请求相关头部<ul>
<li>Origin</li>
<li>Access-Control-Request-Method</li>
<li>Access-Control-Request-Headers</li>
</ul>
</li>
<li>响应相关头部<ul>
<li>Access-Control-Allow-Origin</li>
<li>Access-Control-Allow-Methods</li>
<li>Access-Control-Allow-Headers</li>
<li>Access-Control-Allow-Credentials</li>
<li>Access-Control-Max-Age</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>缓存<ul>
<li>优先级<ul>
<li>s-maxage</li>
<li>max-age</li>
<li>Expires</li>
<li>预估过期时间（浏览器实现实现的”10%算法”）</li>
</ul>
</li>
<li>Cache-Control<ul>
<li>请求中<ul>
<li>max-age=t | max-stale=t | min-fresh=t </li>
<li>no-store | no-cache | no-transform | only-if-cached</li>
</ul>
</li>
<li>响应中<ul>
<li>must-revalidate | proxy-revalidate</li>
<li>public | private </li>
<li>no-cache | no-store | no-transform</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>重定向<ul>
<li>301 http/1.0 永久重定向，可以被缓存，重定向后的请求可以改变method，通常使用get</li>
<li>302 http/1.0 临时重定向，不可被缓存，重定向后的请求可以改变method，通常使用get</li>
<li>307 http/1.1 临时重定向，不可被缓存，重定向后的请求不能改变method</li>
<li>308 http/1.1 永久重定向，可以被缓存，重定向后的请求不能改变method</li>
</ul>
</li>
<li>隧道<ul>
<li>tunnel通过http连接来传输非http协议格式的数据</li>
<li>常用于穿越防火墙/传递ssl消息</li>
<li>通过connect建立连接后变为双向传输，不必遵守http协议</li>
</ul>
</li>
<li>爬虫<ul>
<li>robots.txt<ul>
<li>User-Agent 允许哪些机器人</li>
<li>Disallow 禁止哪些目录</li>
<li>Crawl-delay 访问间隔防止流量过大</li>
<li>Allow 允许哪些目录</li>
<li>Sitemap 站点地图</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="dns"><a href="#dns" class="headerlink" title="dns"></a>dns</h2><ul>
<li>域名与ip之间的映射数据库</li>
<li>查询方式<ul>
<li>迭代查询</li>
<li>递归查询</li>
</ul>
</li>
<li>query<ul>
<li>questions<ul>
<li>QNAME<ul>
<li>.分割多段，每段字节数打头再跟其ASCII编码</li>
<li>最终以 00 结尾</li>
</ul>
</li>
<li>QTYPE<ul>
<li>1 A ipv4地址</li>
<li>2 NS 权威域名服务器</li>
<li>5 CNAME 别名</li>
<li>28 AAAA ipv6地址</li>
</ul>
</li>
<li>QCLASS<ul>
<li>IN 表示internet</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>response<ul>
<li>NAME</li>
<li>TTL time to live</li>
<li>RDLENGTH RDATA length</li>
<li>RDATA 查询值，如ip或CNAME值</li>
</ul>
</li>
</ul>
<h1 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h1><h2 id="BPF过滤器"><a href="#BPF过滤器" class="headerlink" title="BPF过滤器"></a>BPF过滤器</h2><ul>
<li>Berkeley Packet Filter</li>
<li>在设备驱动级别提供抓包接口</li>
<li>表达式<ul>
<li>原语<ul>
<li>Type: host port portrange…</li>
<li>Dir: dst src…</li>
<li>proto: tcp udp…</li>
</ul>
</li>
<li>操作符<ul>
<li>&amp;&amp; and</li>
<li>|| or</li>
<li>! not</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="独有的显示过滤器"><a href="#独有的显示过滤器" class="headerlink" title="独有的显示过滤器"></a>独有的显示过滤器</h2><ul>
<li>view -&gt; internels -&gt; support protocols</li>
<li>操作符<ul>
<li>eq ==</li>
<li>ne !=</li>
<li>gt &gt;</li>
<li>ge &gt;=</li>
<li>lt &lt;</li>
<li>le &lt;=</li>
<li>contains</li>
<li>matches ~</li>
</ul>
</li>
<li>函数<ul>
<li>upper</li>
<li>lower</li>
<li>len</li>
<li>count</li>
<li>string</li>
</ul>
</li>
</ul>
<h1 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h1><h2 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h2><ul>
<li>demo页面：<a href="http://www.websocket.org" target="_blank" rel="noopener">http://www.websocket.org</a></li>
<li>客户端发送数据要进行掩码处理防止针对代理服务器的缓存污染攻击</li>
<li>pingpong心跳保持会话</li>
<li>优点<ul>
<li>浏览器支持率比较高</li>
<li>支持服务器推送</li>
</ul>
</li>
<li>不足<ul>
<li>设计比较简单，很多功能和性能上的问题没有真正解决</li>
</ul>
</li>
</ul>
<h2 id="握手"><a href="#握手" class="headerlink" title="握手"></a>握手</h2><img src="/2019/08/11/net-protocol-capature-packets/handshake.png" title="websocket握手包头">

<h2 id="解密tls"><a href="#解密tls" class="headerlink" title="解密tls"></a>解密tls</h2><ul>
<li>通过浏览器DEBUG日志获得tls握手阶段生成的密钥</li>
<li>步骤<ul>
<li>配置环境变量SSLKEYLOGFILE=path2log使chrome输出DEBUG日志</li>
<li>wireshark配置解析DEBUG日志(编辑/首选项/protocols/tls)</li>
</ul>
</li>
</ul>
<h1 id="http2"><a href="#http2" class="headerlink" title="http2"></a>http2</h1><h2 id="基础-2"><a href="#基础-2" class="headerlink" title="基础"></a>基础</h2><ul>
<li>http1.1的问题<ul>
<li>高延迟<ul>
<li>带宽在增加，延迟却没办法降低</li>
<li>浏览器并发限制</li>
<li>同一连接串行处理请求</li>
</ul>
</li>
<li>无状态特性带来了巨大的http头部</li>
<li>不支持服务器推送</li>
</ul>
</li>
<li>h2主要特性<ul>
<li>传输数据量大幅减小<ul>
<li>标头压缩</li>
<li>二进制传输</li>
</ul>
</li>
<li>多路复用并支持优先级</li>
<li>服务器推送</li>
<li>必须使用tls</li>
</ul>
</li>
<li>tls握手通讯过程<ul>
<li>验证身份</li>
<li>达成安全套件共识</li>
<li>传递密钥</li>
<li>加密通讯</li>
</ul>
</li>
<li>h2核心概念<ul>
<li>连接connection</li>
<li>数据流stream<ul>
<li>通过stream实现多路复用</li>
</ul>
</li>
<li>消息message<ul>
<li>header帧</li>
<li>data帧</li>
</ul>
</li>
<li>数据帧frame</li>
</ul>
</li>
</ul>
<h2 id="frame"><a href="#frame" class="headerlink" title="frame"></a>frame</h2><ul>
<li>帧头部<img src="/2019/08/11/net-protocol-capature-packets/frameHeader.png" title="帧头部"></li>
<li>作用<ul>
<li>多路复用(同一stream内的frame必须是有序的，接收端根据streamID并发组装消息)</li>
<li>客户端建立的流必须是奇数，服务端建立的是偶数</li>
<li>状态管理的约束(ID不能复用，只能递增，超出最大值后必须断掉tcp连接重新建立)</li>
</ul>
</li>
<li>帧类型type<ul>
<li>DATA</li>
<li>HEADERS</li>
<li>PRIORITY</li>
<li>RST_STREAM</li>
<li>SETTINGS</li>
<li>PUSH_PROMISE</li>
<li>PINNG</li>
<li>GOAWAY</li>
<li>WINDOW_UPDATE</li>
<li>CONTINUATION</li>
</ul>
</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/wireshark/">wireshark</a><a href="/tags/tcp-ip/">tcp/ip</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2019/08/10/spring-boot-k8s/"><span>spring boot &amp; k8s</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/08/10/spring-boot-k8s/" rel="bookmark">
        <time class="entry-date published" datetime="2019-08-10T15:01:19.000Z">
          2019-08-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>记录spring boot &amp; k8s学习过程 ~</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/spring/">spring</a><a href="/tags/k8s/">k8s</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2019 prief
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>