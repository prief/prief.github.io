<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>cli | prief | about share and go on</title>

  
  <meta name="author" content="prief">
  

  
  <meta name="description" content="webpackloader
三种使用方式
webpack.config.js
内联在import语句中
在cli命令中指定


常用loader
babel-loader
style-loader 在html中注入style标签
css-loader 解析@import url()等
postcss">
  

  
  
  <meta name="keywords" content>
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="cli">

  <meta property="og:site_name" content="prief">

  
  <meta property="og:image" content="/favicon.ico">
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="prief" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">prief</a>
    </h1>
    <p class="site-description">about share and go on</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>cli</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/08/17/cli/" rel="bookmark">
        <time class="entry-date published" datetime="2019-08-17T08:46:23.000Z">
          2019-08-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><h2 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h2><ul>
<li>三种使用方式<ul>
<li>webpack.config.js</li>
<li>内联在import语句中</li>
<li>在cli命令中指定</li>
</ul>
</li>
<li>常用loader<ul>
<li>babel-loader</li>
<li>style-loader 在html中注入style标签</li>
<li>css-loader 解析@import url()等</li>
<li>postcss-loader</li>
<li>sass-loader</li>
<li>html-loader</li>
<li>vue-loader</li>
<li>file-loader</li>
<li>url-loader</li>
</ul>
</li>
</ul>
<h2 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h2><ul>
<li>常用plugin<ul>
<li>HtmlWebpackPlugin</li>
<li>CommonsChunkPlugin</li>
<li>DefinePlugin</li>
<li>DllPlugin</li>
<li>ExtractTextWebpackPlugin</li>
<li>HotModuleReplacementPlugin</li>
<li>UglifyjsWebpackPlugin</li>
<li>CopyWebpackPlugin</li>
</ul>
</li>
</ul>
<h1 id="工程化模版"><a href="#工程化模版" class="headerlink" title="工程化模版"></a>工程化模版</h1><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><ul>
<li>mkdir template &amp;&amp; cd template &amp;&amp; npm init -y</li>
<li>npm i -D webpack webpack-cli vue-loader vue-template-compiler html-webpack-plugin css-loader style-loader sass-loader sass postcss-loader  postcss-preset-env url-loader file-loader @babel/core @babel/preset-env babel-loader webpack-dev-server connect-multiparty mockjs concurrently</li>
<li>npm i vue vue-router @babel/polyfill axios</li>
<li>浏览器支持列表<ul>
<li>package.json.browserslist</li>
<li>.browserlistrc</li>
<li>browserlist</li>
<li>环境变量BROWSERLIST </li>
</ul>
</li>
<li>.babelrc</li>
<li>postcss.config.js</li>
<li>webpack.config.js</li>
</ul>
<h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><ul>
<li>意义<ul>
<li>避免命名/变量冲突</li>
<li>更清晰的依赖关系</li>
<li>可维护</li>
<li>可复用</li>
<li>降低复杂度</li>
</ul>
</li>
<li>主流实现<ul>
<li>AMD<ul>
<li>异步加载，适合浏览器端</li>
<li>require</li>
<li>define([deps…],(deps…)=&gt;{return {}})</li>
</ul>
</li>
<li>CommonJS<ul>
<li>同步加载，适合服务端，因为大都在本地</li>
<li>require</li>
<li>module.exports | exports.</li>
</ul>
</li>
<li>ES6<ul>
<li>js语言层面支持的模块化，可做静态依赖分析，适合多端</li>
<li>import</li>
<li>export</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="本地开发环境"><a href="#本地开发环境" class="headerlink" title="本地开发环境"></a>本地开发环境</h2><ul>
<li><p>npm install –save-dev webpack-dev-server</p>
</li>
<li><p>“start”: “webpack-dev-server –open”</p>
</li>
<li><p>HMR</p>
<ul>
<li>hotModuleReplacement</li>
<li>能生效是因为模块实现了HMR接口<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (module.hot) &#123;</span><br><span class="line">  module.hot.accept(&quot;./print.js&quot;, function() &#123;</span><br><span class="line">    console.log(&quot;接收更新后的模块&quot;);</span><br><span class="line">    print();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>sourceMap</p>
<ul>
<li>source-map 适合生产环境，映射关系完整但运行慢</li>
<li>eval-source-map 适合开发环境，只映射到行但运行快</li>
</ul>
</li>
</ul>
<h2 id="本地mock"><a href="#本地mock" class="headerlink" title="本地mock"></a>本地mock</h2><ul>
<li>服务 express</li>
<li>路由 url与数据的路由绑定</li>
<li>数据模拟 mockjs<ul>
<li>数据模版定义规范DTD(data template definition)<ul>
<li>属性名 与规则之间用|分割</li>
<li>生成规则 依赖属性值的类型，是可选的</li>
<li>属性值 可以有@占位符，指定了最终值的类型和初始值</li>
<li>例如：’name|rule’: value</li>
</ul>
</li>
<li>数据占位符定义规范DPD(data placeholder definition)</li>
<li>核心api<ul>
<li>mock 将模版输出为最终的数据</li>
<li>random 生成随机数据</li>
</ul>
</li>
</ul>
</li>
<li>concurrently<ul>
<li>同一终端同时运行多个npm命令，不管是否同一进程</li>
</ul>
</li>
</ul>
<h2 id="代码检查"><a href="#代码检查" class="headerlink" title="代码检查"></a>代码检查</h2><ul>
<li>eslint<ul>
<li>npm install -D eslint eslint-loader eslint-plugin-vue babel-eslint eslint-friendly-formatter</li>
<li>plugins指定需要的插件名称，可以忽略eslint-plugin-</li>
<li>默认使用espree解析器，因为有新的语言特性需要指定为babel-eslint</li>
<li>换解析器需要在parserOptions中，防止全局替换导致其他插件失败</li>
<li>es6模块的sourceType为module</li>
<li>禁用eslint规则<ul>
<li>文件开头/* eslint-disable */禁用整个文件的检查</li>
<li>行// eslint-disable-line 禁用行检查</li>
<li>行// eslint-disable-line no-console 禁用console规则</li>
</ul>
</li>
<li>自定义规则<ul>
<li>extends: eslint:recommended</li>
<li>rules:{ no-console: off, quotes:[“wanr”,”single”],indent:[“error”,2]}</li>
<li>数组值第一项表示级别，默认是error</li>
</ul>
</li>
</ul>
</li>
<li>stylelint<ul>
<li>npm install -D stylelint stylelint-webpack-plugin</li>
<li>.stylelintrc.js</li>
<li>禁用规则<ul>
<li>/* stylelint-disable unit-whitelist*/ 禁用unit规则校验</li>
<li>/* stylelint-disable */ 禁用所有规则校验</li>
</ul>
</li>
<li>自定义规则<ul>
<li>extends: “stylelint-config-standard”</li>
<li>rules: {“color-no-invalid-hex”: true}</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="雪碧图"><a href="#雪碧图" class="headerlink" title="雪碧图"></a>雪碧图</h2><ul>
<li>npm install -D webpack-spritesmith</li>
<li>resolve.modules如果是相对路径则按照规则一级一级向上查找，如果是绝对路径不会向上查找</li>
<li>使用<ul>
<li>@import “~sprite.scss”</li>
<li>.icon-picName{@include sprite($picName)}</li>
</ul>
</li>
<li>自定义生成2x样式表<ul>
<li>官网的templateFunction</li>
<li>customTemplates: {function_based_template: templateFunction},</li>
<li>target.css = [[],path.resolve(__dirname, “src/assets/generated/sprite.scss”)]</li>
<li>使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@import &apos;~sprite2.scss&apos;;</span><br><span class="line">&lt;li class=&quot;ico ico-picName&quot;&gt;&lt;/li&gt; </span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="按浏览器构建"><a href="#按浏览器构建" class="headerlink" title="按浏览器构建"></a>按浏览器构建</h2><ul>
<li>新版本浏览器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;module&quot;&gt;&lt;/script&gt; 可直接加载ES6</span><br><span class="line">&lt;link rel=&quot;modulepreload&quot;&gt;&lt;/link&gt; 预加载</span><br></pre></td></tr></table></figure></li>
<li>老版本浏览器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script nomodule&gt;加载旧版本js，新版本浏览器会忽略该引用</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="按环境构建"><a href="#按环境构建" class="headerlink" title="按环境构建"></a>按环境构建</h2><ul>
<li>development</li>
<li>test</li>
<li>production</li>
<li>插件<ul>
<li>npm install –save-dev extract-text-webpack-plugin</li>
<li>npm install –save-dev optimize-css-assets-webpack-plugin</li>
<li>npm install terser-webpack-plugin –save-dev</li>
<li>HashedModuleIdsPlugin 避免不必要的hash变化</li>
</ul>
</li>
</ul>
<h2 id="集成调试工具"><a href="#集成调试工具" class="headerlink" title="集成调试工具"></a>集成调试工具</h2><ul>
<li>weinre / spy-debugger</li>
<li>vconsole<ul>
<li>npm install vconsole</li>
<li>DebugPlugin.js里面去实现 debugtool插件</li>
<li>vconsole.js 里面去new Vconsole</li>
<li>可以单独发一个npm包 debugtool-webpack-plugin</li>
</ul>
</li>
</ul>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><ul>
<li>chai作为断言库</li>
<li>Mocha编写测试用例、测试框架</li>
<li>Karma测试过程管理TestRunner及启动浏览器和生成测试报告</li>
<li>npm install –save-dev karma mocha karma-mocha karma-chrome-launcher karma-webpack karma-sourcemap-loader karma-spec-reporter chai @vue/test-utils karma-coverage babel-plugin-istanbul cross-env</li>
<li>覆盖率<ul>
<li>语句覆盖率</li>
<li>分支覆盖率</li>
<li>函数覆盖率</li>
<li>行覆盖率</li>
</ul>
</li>
</ul>
<h2 id="e2e测试"><a href="#e2e测试" class="headerlink" title="e2e测试"></a>e2e测试</h2><ul>
<li>npm install –save-dev nightwatch chromedriver</li>
<li>npm install –save-dev geckodriver # firefox</li>
<li>npm install –save-dev cross-spawn # 启动子进程</li>
<li>npm install –save-dev nightwatch-html-reporter</li>
<li>nightwatch接口<ul>
<li>断言相关<ul>
<li>expect.element()</li>
<li>.value</li>
<li>.text</li>
<li>.equal(val)/.contain(val)/.match(val)</li>
</ul>
</li>
<li>协议映射相关<ul>
<li>.click()</li>
<li>.url()</li>
<li>.setValue()</li>
<li>.pause()</li>
<li>.waitForElementVisible()</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><ul>
<li>缓存<ul>
<li>开启cache后，模块和生成的chunk如果内容不变则直接用cache，主要解决增量构建过程的性能</li>
<li>HardSourceWebpackPlugin，缓存编译过程中间结果 npm i -D hard-source-webpack-plugin</li>
</ul>
</li>
<li>多线程<ul>
<li>HappyPack</li>
<li>thread-loader #官方推荐</li>
</ul>
</li>
<li>预先编译<ul>
<li>DllPlugin 把基本不变的预先打包出单独dll文件</li>
<li>DllReferencePlugin 配置在文件中引用dll文件</li>
<li>运行一次npm run dll后不需在运行除非dll包有更新</li>
<li>npm i -D add-asset-html-webpack-plugin dll文件提前插入html</li>
<li>与splitChunks功能类似，可以去除splitChunks</li>
</ul>
</li>
</ul>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><ul>
<li>ecs<ul>
<li>const { spawn } = require(“child_process”);</li>
<li>ssh免密登陆</li>
</ul>
</li>
<li>oss<ul>
<li>vinyl-fs</li>
<li>vinyl-ftp</li>
</ul>
</li>
</ul>
<h1 id="cli"><a href="#cli" class="headerlink" title="cli"></a>cli</h1><h2 id="聚合配置并模版化"><a href="#聚合配置并模版化" class="headerlink" title="聚合配置并模版化"></a>聚合配置并模版化</h2><ul>
<li>app.config.js 聚合用户自定义配置</li>
<li>相应的配置都要从app.config.js中获取</li>
</ul>
<h2 id="handlebars模版化"><a href="#handlebars模版化" class="headerlink" title="handlebars模版化"></a>handlebars模版化</h2><ul>
<li>template 存放模版</li>
<li>meta.js 配置入口<ul>
<li>helpers<ul>
<li>语法{{#helperName}}...{{/helperName}}</li>
<li>内置helper if,上面都语法可根据helperName的truthy进行判断</li>
<li>自定义registerHelper</li>
</ul>
</li>
<li>prompts</li>
<li>filters</li>
<li>completeMessage</li>
</ul>
</li>
</ul>
<h2 id="cli-1"><a href="#cli-1" class="headerlink" title="cli"></a>cli</h2><ul>
<li>工作流程<ul>
<li>运行命令 mc init weex pro</li>
<li>下载模版 </li>
<li>交互配置信息</li>
<li>渲染模版</li>
</ul>
</li>
<li>mc<ul>
<li>1个主命令</li>
<li>2个子命令<ul>
<li>mc init</li>
<li>mc help 默认子命令</li>
</ul>
</li>
</ul>
</li>
<li>主命令开发<ul>
<li>npm i commander</li>
<li>npm link #将包链接到全局</li>
</ul>
</li>
<li>子命令模块<ul>
<li>commander</li>
<li>chalk</li>
<li>inquirer</li>
<li>download-git-repo</li>
<li>rimraf</li>
<li>user-home</li>
<li>ora</li>
<li>metalsmith  <ul>
<li>文件处理工具,从哪里读，做什么处理，写到哪里去</li>
<li>use方法绑定插件</li>
<li>source设定源文件目录</li>
<li>destination指定文件写入的目录</li>
<li>clean(true|false)写入前是否删除原来已经存在的文件</li>
<li>build完成对文件的处理接收回调</li>
<li>metadata读取全局数据对象</li>
</ul>
</li>
<li>handlebars </li>
<li>async </li>
<li>consolidate<ul>
<li>各种模版引擎的整合库</li>
<li>还需要引用需要的模版引擎库</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bin/mc</span><br><span class="line"></span><br><span class="line">#!/usr/bin/env node</span><br><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line">program</span><br><span class="line">  .version(require(&apos;../package&apos;).version)</span><br><span class="line">  .usage(&apos;&lt;command&gt; [options]&apos;)</span><br><span class="line">  .command(&apos;init&apos;, &apos;generate a new fe project&apos;);</span><br><span class="line">program.parse(process.argv);</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2019 prief
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>