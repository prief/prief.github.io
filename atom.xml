<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>prief</title>
  
  <subtitle>about share and go on</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://prief.github.io/"/>
  <updated>2019-08-19T14:31:23.609Z</updated>
  <id>https://prief.github.io/</id>
  
  <author>
    <name>prief</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>cli</title>
    <link href="https://prief.github.io/2019/08/17/cli/"/>
    <id>https://prief.github.io/2019/08/17/cli/</id>
    <published>2019-08-17T08:46:23.000Z</published>
    <updated>2019-08-19T14:31:23.609Z</updated>
    
    <content type="html"><![CDATA[<h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><h2 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h2><ul><li>三种使用方式<ul><li>webpack.config.js</li><li>内联在import语句中</li><li>在cli命令中指定</li></ul></li><li>常用loader<ul><li>babel-loader</li><li>style-loader 在html中注入style标签</li><li>css-loader 解析@import url()等</li><li>postcss-loader</li><li>sass-loader</li><li>html-loader</li><li>vue-loader</li><li>file-loader</li><li>url-loader</li></ul></li></ul><h2 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h2><ul><li>常用plugin<ul><li>HtmlWebpackPlugin</li><li>CommonsChunkPlugin</li><li>DefinePlugin</li><li>DllPlugin</li><li>ExtractTextWebpackPlugin</li><li>HotModuleReplacementPlugin</li><li>UglifyjsWebpackPlugin</li><li>CopyWebpackPlugin</li></ul></li></ul><h1 id="工程化模版"><a href="#工程化模版" class="headerlink" title="工程化模版"></a>工程化模版</h1><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><ul><li>mkdir template &amp;&amp; cd template &amp;&amp; npm init -y</li><li>npm i -D webpack webpack-cli vue-loader vue-template-compiler html-webpack-plugin css-loader style-loader sass-loader sass postcss-loader  postcss-preset-env url-loader file-loader @babel/core @babel/preset-env babel-loader webpack-dev-server connect-multiparty mockjs concurrently</li><li>npm i vue vue-router @babel/polyfill axios</li><li>浏览器支持列表<ul><li>package.json.browserslist</li><li>.browserlistrc</li><li>browserlist</li><li>环境变量BROWSERLIST </li></ul></li><li>.babelrc</li><li>postcss.config.js</li><li>webpack.config.js</li></ul><h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><ul><li>意义<ul><li>避免命名/变量冲突</li><li>更清晰的依赖关系</li><li>可维护</li><li>可复用</li><li>降低复杂度</li></ul></li><li>主流实现<ul><li>AMD<ul><li>异步加载，适合浏览器端</li><li>require</li><li>define([deps…],(deps…)=&gt;{return {}})</li></ul></li><li>CommonJS<ul><li>同步加载，适合服务端，因为大都在本地</li><li>require</li><li>module.exports | exports.</li></ul></li><li>ES6<ul><li>js语言层面支持的模块化，可做静态依赖分析，适合多端</li><li>import</li><li>export</li></ul></li></ul></li></ul><h2 id="本地开发环境"><a href="#本地开发环境" class="headerlink" title="本地开发环境"></a>本地开发环境</h2><ul><li><p>npm install –save-dev webpack-dev-server</p></li><li><p>“start”: “webpack-dev-server –open”</p></li><li><p>HMR</p><ul><li>hotModuleReplacement</li><li>能生效是因为模块实现了HMR接口<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (module.hot) &#123;</span><br><span class="line">  module.hot.accept(&quot;./print.js&quot;, function() &#123;</span><br><span class="line">    console.log(&quot;接收更新后的模块&quot;);</span><br><span class="line">    print();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>sourceMap</p><ul><li>source-map 适合生产环境，映射关系完整但运行慢</li><li>eval-source-map 适合开发环境，只映射到行但运行快</li></ul></li></ul><h2 id="本地mock"><a href="#本地mock" class="headerlink" title="本地mock"></a>本地mock</h2><ul><li>服务 express</li><li>路由 url与数据的路由绑定</li><li>数据模拟 mockjs<ul><li>数据模版定义规范DTD(data template definition)<ul><li>属性名 与规则之间用|分割</li><li>生成规则 依赖属性值的类型，是可选的</li><li>属性值 可以有@占位符，指定了最终值的类型和初始值</li><li>例如：’name|rule’: value</li></ul></li><li>数据占位符定义规范DPD(data placeholder definition)</li><li>核心api<ul><li>mock 将模版输出为最终的数据</li><li>random 生成随机数据</li></ul></li></ul></li><li>concurrently<ul><li>同一终端同时运行多个npm命令，不管是否同一进程</li></ul></li></ul><h2 id="代码检查"><a href="#代码检查" class="headerlink" title="代码检查"></a>代码检查</h2><ul><li>eslint<ul><li>npm install -D eslint eslint-loader eslint-plugin-vue babel-eslint eslint-friendly-formatter</li><li>plugins指定需要的插件名称，可以忽略eslint-plugin-</li><li>默认使用espree解析器，因为有新的语言特性需要指定为babel-eslint</li><li>换解析器需要在parserOptions中，防止全局替换导致其他插件失败</li><li>es6模块的sourceType为module</li><li>禁用eslint规则<ul><li>文件开头/* eslint-disable */禁用整个文件的检查</li><li>行// eslint-disable-line 禁用行检查</li><li>行// eslint-disable-line no-console 禁用console规则</li></ul></li><li>自定义规则<ul><li>extends: eslint:recommended</li><li>rules:{ no-console: off, quotes:[“wanr”,”single”],indent:[“error”,2]}</li><li>数组值第一项表示级别，默认是error</li></ul></li></ul></li><li>stylelint<ul><li>npm install -D stylelint stylelint-webpack-plugin</li><li>.stylelintrc.js</li><li>禁用规则<ul><li>/* stylelint-disable unit-whitelist*/ 禁用unit规则校验</li><li>/* stylelint-disable */ 禁用所有规则校验</li></ul></li><li>自定义规则<ul><li>extends: “stylelint-config-standard”</li><li>rules: {“color-no-invalid-hex”: true}</li></ul></li></ul></li></ul><h2 id="雪碧图"><a href="#雪碧图" class="headerlink" title="雪碧图"></a>雪碧图</h2><ul><li>npm install -D webpack-spritesmith</li><li>resolve.modules如果是相对路径则按照规则一级一级向上查找，如果是绝对路径不会向上查找</li><li>使用<ul><li>@import “~sprite.scss”</li><li>.icon-picName{@include sprite($picName)}</li></ul></li><li>自定义生成2x样式表<ul><li>官网的templateFunction</li><li>customTemplates: {function_based_template: templateFunction},</li><li>target.css = [[],path.resolve(__dirname, “src/assets/generated/sprite.scss”)]</li><li>使用<ul><li>@import “~sprite2.scss”;</li><li></li><li class="ico ico-picName"></li></ul></li></ul></li></ul><h2 id="按浏览器构建"><a href="#按浏览器构建" class="headerlink" title="按浏览器构建"></a>按浏览器构建</h2><ul><li>新版本浏览器<ul><li><script type="module"> 可直接加载ES6</li><li><link rel="modulepreload"> 预加载</li></ul></li><li>老版本浏览器<ul><li><script nomodule>加载旧版本js，新版本浏览器会忽略该引用</li></ul></li></ul><h2 id="按环境构建"><a href="#按环境构建" class="headerlink" title="按环境构建"></a>按环境构建</h2><ul><li>development</li><li>test</li><li>production</li><li>插件<ul><li>npm install –save-dev extract-text-webpack-plugin</li><li>npm install –save-dev optimize-css-assets-webpack-plugin</li><li>npm install terser-webpack-plugin –save-dev</li><li>HashedModuleIdsPlugin 避免不必要的hash变化</li></ul></li></ul><h2 id="集成调试工具"><a href="#集成调试工具" class="headerlink" title="集成调试工具"></a>集成调试工具</h2><ul><li>weinre / spy-debugger</li><li>vconsole<ul><li>npm install vconsole</li><li>DebugPlugin.js里面去实现 debugtool插件</li><li>vconsole.js 里面去new Vconsole</li><li>可以单独发一个npm包 debugtool-webpack-plugin</li></ul></li></ul><h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><ul><li>chai作为断言库</li><li>Mocha编写测试用例、测试框架</li><li>Karma测试过程管理TestRunner及启动浏览器和生成测试报告</li><li>npm install –save-dev karma mocha karma-mocha karma-chrome-launcher karma-webpack karma-sourcemap-loader karma-spec-reporter chai @vue/test-utils karma-coverage babel-plugin-istanbul cross-env</li><li>覆盖率<ul><li>语句覆盖率</li><li>分支覆盖率</li><li>函数覆盖率</li><li>行覆盖率</li></ul></li></ul><h2 id="e2e测试"><a href="#e2e测试" class="headerlink" title="e2e测试"></a>e2e测试</h2><ul><li>npm install –save-dev nightwatch chromedriver</li><li>npm install –save-dev geckodriver # firefox</li><li>npm install –save-dev cross-spawn # 启动子进程</li><li>npm install –save-dev nightwatch-html-reporter</li><li>nightwatch接口<ul><li>断言相关<ul><li>expect.element()</li><li>.value</li><li>.text</li><li>.equal(val)/.contain(val)/.match(val)</li></ul></li><li>协议映射相关<ul><li>.click()</li><li>.url()</li><li>.setValue()</li><li>.pause()</li><li>.waitForElementVisible()</li></ul></li></ul></li></ul><h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><ul><li>缓存<ul><li>开启cache后，模块和生成的chunk如果内容不变则直接用cache，主要解决增量构建过程的性能</li><li>HardSourceWebpackPlugin，缓存编译过程中间结果 npm i -D hard-source-webpack-plugin</li></ul></li><li>多线程<ul><li>HappyPack</li><li>thread-loader #官方推荐</li></ul></li><li>预先编译<ul><li>DllPlugin 把基本不变的预先打包出单独dll文件</li><li>DllReferencePlugin 配置在文件中引用dll文件</li><li>运行一次npm run dll后不需在运行除非dll包有更新</li><li>npm i -D add-asset-html-webpack-plugin dll文件提前插入html</li><li>与splitChunks功能类似，可以去除splitChunks</li></ul></li></ul><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><ul><li>ecs<ul><li>const { spawn } = require(“child_process”);</li><li>ssh免密登陆</li></ul></li><li>oss<ul><li>vinyl-fs</li><li>vinyl-ftp</li></ul></li></ul><h1 id="cli"><a href="#cli" class="headerlink" title="cli"></a>cli</h1><h2 id="聚合配置并模版化"><a href="#聚合配置并模版化" class="headerlink" title="聚合配置并模版化"></a>聚合配置并模版化</h2><ul><li>app.config.js 聚合用户自定义配置</li><li>响应的配置都要从app.config.js中获取</li></ul><h2 id="handlebars模版化"><a href="#handlebars模版化" class="headerlink" title="handlebars模版化"></a>handlebars模版化</h2><ul><li>template 存放模版</li><li>meta.js 配置入口<ul><li>helpers<ul><li>语法{{#helperName}}...{{/helperName}}</li><li>内置helper if,上面都语法可根据helperName的truthy进行判断</li><li>自定义registerHelper</li></ul></li><li>prompts</li><li>filters</li><li>completeMessage</li></ul></li></ul><h2 id="cli-1"><a href="#cli-1" class="headerlink" title="cli"></a>cli</h2><ul><li>工作流程<ul><li>运行命令 mc init weex pro</li><li>下载模版 </li><li>交互配置信息</li><li>渲染模版</li></ul></li><li>mc<ul><li>1个主命令</li><li>2个子命令<ul><li>mc init</li><li>mc help 默认子命令</li></ul></li></ul></li><li>主命令开发<ul><li>npm i commander</li><li>npm link #将包链接到全局</li></ul></li><li>子命令模块<ul><li>commander</li><li>chalk</li><li>inquirer</li><li>download-git-repo</li><li>rimraf</li><li>user-home</li><li>ora</li><li>metalsmith  <ul><li>文件处理工具,从哪里读，做什么处理，写到哪里去</li><li>use方法绑定插件</li><li>source设定源文件目录</li><li>destination指定文件写入的目录</li><li>clean(true|false)写入前是否删除原来已经存在的文件</li><li>build完成对文件的处理接收回调</li><li>metadata读取全局数据对象</li></ul></li><li>handlebars </li><li>async </li><li>consolidate<ul><li>各种模版引擎的整合库</li><li>还需要引用需要的模版引擎库</li></ul></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bin/mc</span><br><span class="line"></span><br><span class="line">#!/usr/bin/env node</span><br><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line">program</span><br><span class="line">  .version(require(&apos;../package&apos;).version)</span><br><span class="line">  .usage(&apos;&lt;command&gt; [options]&apos;)</span><br><span class="line">  .command(&apos;init&apos;, &apos;generate a new fe project&apos;);</span><br><span class="line">program.parse(process.argv);</span><br></pre></td></tr></table></figure></script></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;webpack&quot;&gt;&lt;a href=&quot;#webpack&quot; class=&quot;headerlink&quot; title=&quot;webpack&quot;&gt;&lt;/a&gt;webpack&lt;/h1&gt;&lt;h2 id=&quot;loader&quot;&gt;&lt;a href=&quot;#loader&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>webpack</title>
    <link href="https://prief.github.io/2019/08/17/webpack/"/>
    <id>https://prief.github.io/2019/08/17/webpack/</id>
    <published>2019-08-17T08:29:05.000Z</published>
    <updated>2019-08-17T08:46:10.888Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h1><h1 id="进阶篇"><a href="#进阶篇" class="headerlink" title="进阶篇"></a>进阶篇</h1><h1 id="原理篇"><a href="#原理篇" class="headerlink" title="原理篇"></a>原理篇</h1><h1 id="实战篇"><a href="#实战篇" class="headerlink" title="实战篇"></a>实战篇</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;基础篇&quot;&gt;&lt;a href=&quot;#基础篇&quot; class=&quot;headerlink&quot; title=&quot;基础篇&quot;&gt;&lt;/a&gt;基础篇&lt;/h1&gt;&lt;h1 id=&quot;进阶篇&quot;&gt;&lt;a href=&quot;#进阶篇&quot; class=&quot;headerlink&quot; title=&quot;进阶篇&quot;&gt;&lt;/a&gt;进阶篇&lt;/h
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>vscode</title>
    <link href="https://prief.github.io/2019/08/15/vscode/"/>
    <id>https://prief.github.io/2019/08/15/vscode/</id>
    <published>2019-08-15T14:44:49.000Z</published>
    <updated>2019-08-17T08:08:19.386Z</updated>
    
    <content type="html"><![CDATA[<h1 id="命令面板"><a href="#命令面板" class="headerlink" title="命令面板"></a>命令面板</h1><h2 id="常用"><a href="#常用" class="headerlink" title="常用"></a>常用</h2><ul><li>cmd + shift + P<ul><li>shell &amp;&amp; install code in PATH</li><li>transfrom upper|lower</li></ul></li><li>cmd + P<ul><li>快速搜索打开文件</li></ul></li><li>cmd<ul><li>code –help</li><li>code -r reuseWindow folder|file</li><li>code -r -g package.json:128 #打开文件128行</li><li>code -r -d file1 file2 #对比2个文件</li><li>ls | code -r - #接受管道数据</li></ul></li></ul><h1 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h1><h2 id="光标"><a href="#光标" class="headerlink" title="光标"></a>光标</h2><ul><li>option + 左箭头 #单词为单位向左跳动</li><li>option + 右箭头 #单词为单位向右跳动</li><li>cmd + 左箭头  #直接跳到行首</li><li>cmd + 右箭头  #直接跳到行尾</li><li>cmd + 上箭头  #直接跳到文件头部</li><li>cmd + 下箭头  #直接跳到文件尾部</li><li>cmd + Enter  #下面开始一行</li><li>cmd + option + 上下 # 创建多光标</li><li>ctrl + g #跳到指定行</li><li>cmd + shift + O #跳到指定符号</li></ul><h2 id="文本选择"><a href="#文本选择" class="headerlink" title="文本选择"></a>文本选择</h2><ul><li>移动光标的同时按住shift进行文本的选择</li><li>cmd + D #多文本选择</li></ul><h2 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h2><ul><li>option + 上下 #移动当前行</li></ul><h2 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h2><ul><li>option + shift + 上下 #复制当前行</li></ul><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><ul><li>cmd + delete #删除光标到行首</li><li>cmd + shift + K #删除当前行</li><li>cmd + X #剪切</li></ul><h2 id="格式化代码"><a href="#格式化代码" class="headerlink" title="格式化代码"></a>格式化代码</h2><ul><li>option + shift + F </li></ul><h1 id="vscode相关"><a href="#vscode相关" class="headerlink" title="vscode相关"></a>vscode相关</h1><h2 id="创建codeSnippets"><a href="#创建codeSnippets" class="headerlink" title="创建codeSnippets"></a>创建codeSnippets</h2><ul><li>cmd + shift + P</li><li>user snippets<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &quot;Print to console&quot;: &#123;</span><br><span class="line">    &quot;prefix&quot;: &quot;log&quot;,</span><br><span class="line">    &quot;body&quot;: [</span><br><span class="line">        &quot;console.log($&#123;1:i&#125;);&quot;,</span><br><span class="line">        &quot;console.log($&#123;1:i&#125; + 1); // $&#123;1:i&#125; + 1&quot;,</span><br><span class="line">        &quot;$2&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;description&quot;: &quot;Log output to console&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="vscode"><a href="#vscode" class="headerlink" title=".vscode"></a>.vscode</h2><ul><li>settings.json</li><li>tasks.json</li><li>launch.json</li><li>extensions.json</li></ul><h2 id="语言支持"><a href="#语言支持" class="headerlink" title="语言支持"></a>语言支持</h2><ul><li>json<ul><li>可自己定义jsonSchema做智能提示</li></ul></li><li>markdown<ul><li>open preview</li></ul></li><li>js<ul><li>jsDoc(可做接口文档/编码提示)</li><li>d.ts(ts接口定义)</li><li>// @ts-check 开启ts校验逐步过度到ts</li><li>logpoint 把原本调试时需要的console.log与断点结合 { str + “” }</li></ul></li><li>emmet<ul><li>emmet.triggerExpansionOnTab: true #输入后按tab自动展开</li><li>“emmet.includeLanguages”: {“vue-html”: “html”}</li><li>ui&gt;li*3</li><li>div+p</li><li>div#list&gt;li.list-item</li><li>#page&gt;div.logo+ul#navigation&gt;li*5&gt;a{Item $}</li><li>转到匹配对/删除节点(自动删除开闭节点)</li></ul></li></ul><h1 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h1><h2 id="本质"><a href="#本质" class="headerlink" title="本质"></a>本质</h2><ul><li>是一个nodejs应用</li><li>可以操作vscodeAPI进行插件功能实现</li></ul><h2 id="创建插件"><a href="#创建插件" class="headerlink" title="创建插件"></a>创建插件</h2><ul><li>npm i -g yeoman generator-code</li><li>yo code myExtName</li><li>extension.js<ul><li>const vscode = require(“vscode”);</li><li>exports.activate = function activate(ctx){}</li><li>exports.deactivate = function deactivate(){}</li></ul></li><li>package.json<ul><li>engines : { “vscode”: “^1.29.0” }</li><li>“activationEvents”: [ “onCommand:extension.sayHello” ]</li><li>“contributes”: { “commands”: [ {“command”: “extension.sayHello”, “title”: “Hello World” }]}</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;命令面板&quot;&gt;&lt;a href=&quot;#命令面板&quot; class=&quot;headerlink&quot; title=&quot;命令面板&quot;&gt;&lt;/a&gt;命令面板&lt;/h1&gt;&lt;h2 id=&quot;常用&quot;&gt;&lt;a href=&quot;#常用&quot; class=&quot;headerlink&quot; title=&quot;常用&quot;&gt;&lt;/a&gt;常用&lt;/h
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>my tools</title>
    <link href="https://prief.github.io/2019/08/11/my-tools/"/>
    <id>https://prief.github.io/2019/08/11/my-tools/</id>
    <published>2019-08-11T03:13:12.000Z</published>
    <updated>2019-08-17T06:45:33.247Z</updated>
    
    <content type="html"><![CDATA[<h1 id="os"><a href="#os" class="headerlink" title="os"></a>os</h1><ul><li>git</li><li>iterm</li><li>wireshark</li></ul><h1 id="fe"><a href="#fe" class="headerlink" title="fe"></a>fe</h1><ul><li>chrome</li><li>vscode<ul><li>vscode-icons</li><li>markdown TOC</li><li>gitlens</li><li>debugger for chrome</li><li>code runner</li><li>Java Extension Pack</li><li>go</li><li>python</li></ul></li><li>node<ul><li></li></ul></li></ul><h1 id="android"><a href="#android" class="headerlink" title="android"></a>android</h1><ul><li>as</li></ul><h1 id="ios"><a href="#ios" class="headerlink" title="ios"></a>ios</h1><ul><li>homebrew</li><li>xcode</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;os&quot;&gt;&lt;a href=&quot;#os&quot; class=&quot;headerlink&quot; title=&quot;os&quot;&gt;&lt;/a&gt;os&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;git&lt;/li&gt;
&lt;li&gt;iterm&lt;/li&gt;
&lt;li&gt;wireshark&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;fe&quot;&gt;&lt;a 
      
    
    </summary>
    
    
      <category term="tools" scheme="https://prief.github.io/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>net protocol &amp; capature packets</title>
    <link href="https://prief.github.io/2019/08/11/net-protocol-capature-packets/"/>
    <id>https://prief.github.io/2019/08/11/net-protocol-capature-packets/</id>
    <published>2019-08-10T23:30:55.000Z</published>
    <updated>2019-08-15T13:54:34.340Z</updated>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="协议栈"><a href="#协议栈" class="headerlink" title="协议栈"></a>协议栈</h2><ul><li>应用层<ul><li>http/1.1</li><li>websocket</li><li>http/2.0</li></ul></li><li>表示层<ul><li>tls/ssl</li></ul></li><li>传输层<ul><li>tcp</li></ul></li><li>网络层<ul><li>ip</li></ul></li><li>链路层<ul><li>以太网</li></ul></li></ul><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><ul><li>chrome</li><li>wireshark</li><li>dig</li><li>tcpdump</li></ul><h1 id="http-1-1"><a href="#http-1-1" class="headerlink" title="http/1.1"></a>http/1.1</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><ul><li>RFC: request for comments</li><li>http/1.1<ul><li>无状态</li><li>请求/响应模式</li><li>可扩展的语义</li><li>自描述的消息格式</li></ul></li><li>ABNF: 扩充巴科斯-瑙尔范式<ul><li>空白字符SP来分割各个元素</li><li>/表示可供选择的规则</li><li>%x##-##表示值的范围</li><li>()组合，视为一个元素</li><li>m*n表示重复m-n次</li><li>[]表示可选序列</li><li>DIGIT表示数字</li><li>HEXDIG表示十六进制数字</li><li>SP表示空格</li><li>CRLF表示兼容的回车换行</li></ul></li><li>OSI: open system interconnection reference model概念模型<ul><li>应用层（http/email/dns/smtp/ftp/telnet）</li><li>表示层（ssl）</li><li>会话层（session）</li><li>传输层（tcp/udp）</li><li>网络层（ip，广域网路由器）</li><li>数据链路层（mac，局域网交换机）</li><li>物理层</li></ul></li><li>TCP/IP 事实实现方案<ul><li>应用层（http/email/dns/smtp/ftp/telnet）</li><li>传输层（tcp/udp）</li><li>网络层（ip/icmp/arp）</li><li>物理层（ethernet）</li></ul></li><li>评估web架构的关键属性<ul><li>性能performance<ul><li>网络性能 throughput吞吐量&lt;=bandwidth</li><li>用户感知性能</li><li>网络效率 缓存/cdn/减少交互次数</li></ul></li><li>可伸缩性scalability</li><li>简单性simplicity</li><li>可见性visiable</li><li>可移植性portablity</li><li>可靠性reliability</li><li>可修改性modifiability<ul><li>可进化</li><li>可定制</li><li>可扩展</li><li>可配置</li><li>可重用</li></ul></li></ul></li><li>URI<ul><li>URI是URL+URN的超集，统一掉概念</li><li>schema://user:pass@hostname:port/path?query#fragment</li></ul></li><li>method<ul><li>GET</li><li>HEAD</li><li>POST</li><li>PUT</li><li>DELETE</li><li>CONNECT</li><li>OPTIONS</li><li>TRACE</li></ul></li><li>status<ul><li>1xx 请求服务器已经收到，需要进一步处理<ul><li>100 Continue常用上传大文件前</li><li>101 Switch Protocols升级协议ws/h2</li><li>102 Processing webdav协议</li></ul></li><li>2xx 成功处理了请求，当接收到不认识的2xx时默认用200<ul><li>200 OK</li><li>201 Created成功创建</li><li>202 Accepted</li><li>206 Partial Content 使用range协议返回部分内容</li></ul></li><li>3xx 重定向<ul><li>301 Moved Permanently 永久重定向，可被缓存</li><li>302 Found 临时重定向，不能被缓存</li><li>304 Not Modified 可复用缓存</li></ul></li><li>4xx 客户端错误<ul><li>400 Bad Request</li><li>401 Unauthorized未认证</li><li>403 Forbidden</li><li>404 Not Found</li></ul></li><li>5xx 服务端错误<ul><li>500 Internel Server Error 内部服务器错误，当接收到不认识的5xx时默认用500</li><li>501 Not Implemented</li><li>502 Bad Gateway</li><li>503 Service Unavailable</li><li>504 Gateway Timeout</li></ul></li></ul></li><li>长短连接 <ul><li>Connection: Keep-Alive | Close</li><li>http/1.1默认支持长连接</li><li>如果Connection后面跟header字段则表示对代理服务器要求不做此header转发</li><li>Connection只表示tcp连接的两端，不能表示跨中间的服务器</li></ul></li><li>header<ul><li>X-Forwarded-For 用于传递ip，每走一层都会append一个ip</li><li>X-Real-IP 只记录用户外网ip</li><li>Referer 来源，通常做防盗链</li><li>User-Agent</li><li>From 通常是爬虫添加的后面跟邮件地址告诉server可通过邮件联系</li><li>Allow server支持的method</li><li>Accept* 协商资源表现形式<ul><li>Accept: MIME q=0.8;</li><li>Accept-Language: zh-CN,zh q=0.8</li><li>Accept-Encoding: gzip | br | deflate</li><li>Accept-Range: bytes | none 是否支持range请求</li></ul></li><li>Transer-Encoding: chunked | gzip 不定长包体传输格式</li><li>Content-Disposition: inline | attachment[; filename=xx.xx]</li></ul></li><li>MIME<ul><li>Multipurpose Internet Mail Extensions</li><li>格式：type/subType(;params)</li><li>type<ul><li>text</li><li>image</li><li>audio</li><li>video</li><li>application</li></ul></li><li>params<ul><li>attribute=value</li></ul></li></ul></li><li>Form关键属性<ul><li>action表示uri</li><li>method表示方法<ul><li>GET</li><li>POST</li></ul></li><li>enctype<ul><li>application/x-www-form-urlencoded 默认编码方式 k=v&amp;k=v 需要encode</li><li>multipart/form-data 有boundary做分割，一般用于文件传输</li></ul></li></ul></li><li>Range请求<ul><li>做多线程下载/断点续传/点播视频等</li><li>请求头部标明<ul><li>Range: bytes=0-499[,500-1000[,1001-]]</li><li>Range: bytes=-4 最后3个字节</li><li>If-Range: Etag | httpDate 验证已经下载的部分是否有变动</li></ul></li><li>响应头部标明<ul><li>Content-Range: bytes 0-100/2000 表示共2000长度，返回了前101字节</li><li>Content-Range: bytes 0-100/* 表示不知道总长度但返回了前101字节  </li><li>Content-Range: multipart/byterages; boundary=…</li></ul></li></ul></li><li>cookie<ul><li>Set-Cookie<ul><li>每一个Set-Cookie只能设置一个name=value，如需多个需要多个Set-Cookie</li><li>name=value; expires= httpDate; max-age=X; domain=X; path=/; secure; httpOnly;</li></ul></li><li>Cookie<ul><li>可以把多个Set-Cookie返回的name组合成一个进行请求</li><li>name=value;[ name=value;]</li></ul></li></ul></li><li>同源三要素<ul><li>schema</li><li>hostname</li><li>port</li></ul></li><li>跨域<ul><li>可跨域的组件（满足可扩展可用性）<ul><li>script</li><li>link</li><li>img</li><li>iframe</li><li>video</li><li>audio</li></ul></li><li>攻击与防护<ul><li>csrf <ul><li>cross-site request forgery</li><li>通过referer可做一层防护</li><li>通过csrfToken即服务器响应表单时添加隐藏的token信息已备后续验证也可做防护</li></ul></li><li>xss cross-site scripting</li></ul></li><li>cors<ul><li>cross origin resource sharing</li><li>简单请求三要素<ul><li>GET/HEAD/POST之一</li><li>Accepte/Accept-Language/Content-Type安全header之一</li><li>Content-Type是text/plain|application/x-www-form-urlencoded|multipart/form-data之一</li></ul></li><li>复杂请求<ul><li>简单请求之外的都是复杂请求</li><li>复杂请求必须先走一个OPTIONS请求</li></ul></li><li>请求相关头部<ul><li>Origin</li><li>Access-Control-Request-Method</li><li>Access-Control-Request-Headers</li></ul></li><li>响应相关头部<ul><li>Access-Control-Allow-Origin</li><li>Access-Control-Allow-Methods</li><li>Access-Control-Allow-Headers</li><li>Access-Control-Allow-Credentials</li><li>Access-Control-Max-Age</li></ul></li></ul></li></ul></li><li>缓存<ul><li>优先级<ul><li>s-maxage</li><li>max-age</li><li>Expires</li><li>预估过期时间（浏览器实现实现的”10%算法”）</li></ul></li><li>Cache-Control<ul><li>请求中<ul><li>max-age=t | max-stale=t | min-fresh=t </li><li>no-store | no-cache | no-transform | only-if-cached</li></ul></li><li>响应中<ul><li>must-revalidate | proxy-revalidate</li><li>public | private </li><li>no-cache | no-store | no-transform</li></ul></li></ul></li></ul></li><li>重定向<ul><li>301 http/1.0 永久重定向，可以被缓存，重定向后的请求可以改变method，通常使用get</li><li>302 http/1.0 临时重定向，不可被缓存，重定向后的请求可以改变method，通常使用get</li><li>307 http/1.1 临时重定向，不可被缓存，重定向后的请求不能改变method</li><li>308 http/1.1 永久重定向，可以被缓存，重定向后的请求不能改变method</li></ul></li><li>隧道<ul><li>tunnel通过http连接来传输非http协议格式的数据</li><li>常用于穿越防火墙/传递ssl消息</li><li>通过connect建立连接后变为双向传输，不必遵守http协议</li></ul></li><li>爬虫<ul><li>robots.txt<ul><li>User-Agent 允许哪些机器人</li><li>Disallow 禁止哪些目录</li><li>Crawl-delay 访问间隔防止流量过大</li><li>Allow 允许哪些目录</li><li>Sitemap 站点地图</li></ul></li></ul></li></ul><h2 id="dns"><a href="#dns" class="headerlink" title="dns"></a>dns</h2><ul><li>域名与ip之间的映射数据库</li><li>查询方式<ul><li>迭代查询</li><li>递归查询</li></ul></li><li>query<ul><li>questions<ul><li>QNAME<ul><li>.分割多段，每段字节数打头再跟其ASCII编码</li><li>最终以 00 结尾</li></ul></li><li>QTYPE<ul><li>1 A ipv4地址</li><li>2 NS 权威域名服务器</li><li>5 CNAME 别名</li><li>28 AAAA ipv6地址</li></ul></li><li>QCLASS<ul><li>IN 表示internet</li></ul></li></ul></li></ul></li><li>response<ul><li>NAME</li><li>TTL time to live</li><li>RDLENGTH RDATA length</li><li>RDATA 查询值，如ip或CNAME值</li></ul></li></ul><h1 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h1><h2 id="BPF过滤器"><a href="#BPF过滤器" class="headerlink" title="BPF过滤器"></a>BPF过滤器</h2><ul><li>Berkeley Packet Filter</li><li>在设备驱动级别提供抓包接口</li><li>表达式<ul><li>原语<ul><li>Type: host port portrange…</li><li>Dir: dst src…</li><li>proto: tcp udp…</li></ul></li><li>操作符<ul><li>&amp;&amp; and</li><li>|| or</li><li>! not</li></ul></li></ul></li></ul><h2 id="独有的显示过滤器"><a href="#独有的显示过滤器" class="headerlink" title="独有的显示过滤器"></a>独有的显示过滤器</h2><ul><li>view -&gt; internels -&gt; support protocols</li><li>操作符<ul><li>eq ==</li><li>ne !=</li><li>gt &gt;</li><li>ge &gt;=</li><li>lt &lt;</li><li>le &lt;=</li><li>contains</li><li>matches ~</li></ul></li><li>函数<ul><li>upper</li><li>lower</li><li>len</li><li>count</li><li>string</li></ul></li></ul><h1 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h1><h2 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h2><ul><li>demo页面：<a href="http://www.websocket.org" target="_blank" rel="noopener">http://www.websocket.org</a></li><li>客户端发送数据要进行掩码处理防止针对代理服务器的缓存污染攻击</li><li>pingpong心跳保持会话</li><li>优点<ul><li>浏览器支持率比较高</li><li>支持服务器推送</li></ul></li><li>不足<ul><li>设计比较简单，很多功能和性能上的问题没有真正解决</li></ul></li></ul><h2 id="握手"><a href="#握手" class="headerlink" title="握手"></a>握手</h2><img src="/2019/08/11/net-protocol-capature-packets/handshake.png" title="websocket握手包头"><h2 id="解密tls"><a href="#解密tls" class="headerlink" title="解密tls"></a>解密tls</h2><ul><li>通过浏览器DEBUG日志获得tls握手阶段生成的密钥</li><li>步骤<ul><li>配置环境变量SSLKEYLOGFILE=path2log使chrome输出DEBUG日志</li><li>wireshark配置解析DEBUG日志(编辑/首选项/protocols/tls)</li></ul></li></ul><h1 id="http2"><a href="#http2" class="headerlink" title="http2"></a>http2</h1><h2 id="基础-2"><a href="#基础-2" class="headerlink" title="基础"></a>基础</h2><ul><li>http1.1的问题<ul><li>高延迟<ul><li>带宽在增加，延迟却没办法降低</li><li>浏览器并发限制</li><li>同一连接串行处理请求</li></ul></li><li>无状态特性带来了巨大的http头部</li><li>不支持服务器推送</li></ul></li><li>h2主要特性<ul><li>传输数据量大幅减小<ul><li>标头压缩</li><li>二进制传输</li></ul></li><li>多路复用并支持优先级</li><li>服务器推送</li><li>必须使用tls</li></ul></li><li>tls握手通讯过程<ul><li>验证身份</li><li>达成安全套件共识</li><li>传递密钥</li><li>加密通讯</li></ul></li><li>h2核心概念<ul><li>连接connection</li><li>数据流stream<ul><li>通过stream实现多路复用</li></ul></li><li>消息message<ul><li>header帧</li><li>data帧</li></ul></li><li>数据帧frame</li></ul></li></ul><h2 id="frame"><a href="#frame" class="headerlink" title="frame"></a>frame</h2><ul><li>帧头部<img src="/2019/08/11/net-protocol-capature-packets/frameHeader.png" title="帧头部"></li><li>作用<ul><li>多路复用(同一stream内的frame必须是有序的，接收端根据streamID并发组装消息)</li><li>客户端建立的流必须是奇数，服务端建立的是偶数</li><li>状态管理的约束(ID不能复用，只能递增，超出最大值后必须断掉tcp连接重新建立)</li></ul></li><li>帧类型type<ul><li>DATA</li><li>HEADERS</li><li>PRIORITY</li><li>RST_STREAM</li><li>SETTINGS</li><li>PUSH_PROMISE</li><li>PINNG</li><li>GOAWAY</li><li>WINDOW_UPDATE</li><li>CONTINUATION</li></ul></li><li>hpack<ul><li>头部压缩算法</li><li>三种压缩方式相结合<ul><li>静态字典</li><li>动态字典</li><li>压缩算法huffman编码</li></ul></li></ul></li></ul><h2 id="服务推送"><a href="#服务推送" class="headerlink" title="服务推送"></a>服务推送</h2><ul><li>每一条推送都基于一个请求</li><li>在请求的响应中可以恢复即将推送的资源</li><li>再开一个stream进行资源的推送，不同的stream可以实现并发</li></ul><h2 id="流控"><a href="#流控" class="headerlink" title="流控"></a>流控</h2><ul><li>应用层和tcp层都可以做</li><li>发送和接口流量控制是可以分开作用的</li><li>只有DATA帧才受流控限制</li><li>流控不能被禁用</li></ul><h2 id="h2现存问题"><a href="#h2现存问题" class="headerlink" title="h2现存问题"></a>h2现存问题</h2><ul><li>tcp+tls建链握手过多<ul><li>必须建立在tls之上</li></ul></li><li>多路复用与tcp队头阻塞问题<ul><li>本质还是在tcp流中是串行的</li><li>串行对头中丢失一个包就会阻塞后面的包</li></ul></li><li>tcp是由操作系统内核实现的，内核更新慢</li></ul><h2 id="http3"><a href="#http3" class="headerlink" title="http3"></a>http3</h2><ul><li>基于quick协议与h2协议共同成为h3</li><li>quick协议基于udp/ip协议之上，h2协议之下</li><li>quick协议实现了<ul><li>多路复用</li><li>tls</li><li>拥塞控制</li><li>丢包重发</li></ul></li><li>优势<ul><li>可以连接迁移</li><li>解决了队头阻塞问题</li><li>1RTT完全就握手完毕</li></ul></li></ul><h1 id="tls"><a href="#tls" class="headerlink" title="tls"></a>tls</h1><h2 id="基础-3"><a href="#基础-3" class="headerlink" title="基础"></a>基础</h2><ul><li>概念<ul><li>ssl secure sockets layer</li><li>tls transport layer security</li></ul></li><li>发展历史<ul><li>ssl3.0</li><li>tls1.0</li><li>tls1.1</li><li>tls1.2</li><li>tls1.3</li></ul></li><li>设计目的<ul><li>身份验证</li><li>保密性</li><li>完整性</li></ul></li><li>主要功能<ul><li>握手</li><li>交换密钥</li><li>告警</li><li>对称加密数据</li><li>记录</li></ul></li><li>tls握手通讯过程<ul><li>验证身份</li><li>达成安全套件共识</li><li>传递密钥</li><li>加密通讯</li></ul></li><li>安全加密套件<ul><li>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</li><li>ECDHE 密钥交换算法</li><li>RSA 身份验证算法</li><li>AES 对称加密算法</li><li>128 对称加密强度</li><li>GCM 对称加密模式</li><li>SHA256 签名hash算法</li></ul></li></ul><h2 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h2><ul><li>工作原理<ul><li>XOR运算 速度快</li><li>padding填充 <ul><li>会把明文进行blockCipher分组进行加密</li><li>当分组后最后一个block可能长度不够XOR运算，需要padding</li><li>填充时可以按bit位进行填充也可按byte字节填充</li><li>RFC中常用按byte字节进行填充，填充内容是多少个字节就填充多少个数字，即PKCS7填充算法</li></ul></li><li>工作模式<ul><li>常用GCM工作模式</li><li>Galois/Counter Mode</li></ul></li></ul></li><li>AES<ul><li>advanced encryption standard加密算法</li><li>常用填充算法PKCS7</li><li>常用工作模式GCM</li><li>三种密钥长度<ul><li>AES-128密钥长度16字节，加密轮数10</li><li>AES-192密钥长度24字节，加密轮数12</li><li>AES-256密钥长度32字节，加密轮数14</li></ul></li><li>加密步骤<ul><li>明文按照16字节拆分成若干块，每个块是4*4矩阵</li><li>按填充算法进行最后一块的填充</li><li>每一个明文块用AES加密算法和密钥进行加密</li><li>拼接所有密文块</li></ul></li></ul></li></ul><h2 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h2><ul><li>RSA </li><li>openssl<ul><li>生成私钥 openssl genrsa -out private.pem</li><li>提取公钥 openssl rsa -in private.pem -pubout -out public.pem</li><li>加密文件 openssl rsautl -encrypt -in hello.txt -inkey public.pem -pubin -out hello.en </li><li>解密文件 openssl rsautl -decrypt -in hello.en -inkey private.pem -out hello.de</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h1&gt;&lt;h2 id=&quot;协议栈&quot;&gt;&lt;a href=&quot;#协议栈&quot; class=&quot;headerlink&quot; title=&quot;协议栈&quot;&gt;&lt;/a&gt;协议栈&lt;/h2&gt;&lt;u
      
    
    </summary>
    
    
      <category term="wireshark" scheme="https://prief.github.io/tags/wireshark/"/>
    
      <category term="tcp/ip" scheme="https://prief.github.io/tags/tcp-ip/"/>
    
  </entry>
  
  <entry>
    <title>spring boot &amp; k8s</title>
    <link href="https://prief.github.io/2019/08/10/spring-boot-k8s/"/>
    <id>https://prief.github.io/2019/08/10/spring-boot-k8s/</id>
    <published>2019-08-10T15:01:19.000Z</published>
    <updated>2019-08-17T03:01:46.852Z</updated>
    
    <content type="html"><![CDATA[<p>记录spring boot &amp; k8s学习过程 </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;记录spring boot &amp;amp; k8s学习过程 &lt;/p&gt;

      
    
    </summary>
    
    
      <category term="spring" scheme="https://prief.github.io/tags/spring/"/>
    
      <category term="k8s" scheme="https://prief.github.io/tags/k8s/"/>
    
  </entry>
  
</feed>
